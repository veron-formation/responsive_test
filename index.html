<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test responsive iframe</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; box-sizing: border-box; }
    *, *::before, *::after { box-sizing: inherit; }

    .page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: clamp(12px, 3vw, 32px);
      background: linear-gradient(180deg, #eaf4ff 0%, #ffffff 100%);
      font-family: Inter, Arial, Helvetica, sans-serif;
    }

    .card {
      width: 100%;
      max-width: 960px;
      background: #2d89ef;
      color: #fff;
      border-radius: 12px;
      padding: clamp(16px, 4vw, 40px);
      text-align: center;
      box-shadow: 0 8px 24px rgba(13, 30, 60, 0.12);
    }

    /* Conteneur pour les flÃ¨ches et les compteurs (au-dessus du carrousel) */
    .carousel-header {
    display: flex;
    justify-content: center; /* Alignement au centre */
    align-items: center;
    gap: 15px; /* AugmentÃ© pour mieux sÃ©parer les Ã©lÃ©ments */
    margin-bottom: 10px;
    padding: 0 10px;
    font-size: 1.1em;
    }

    /* ðŸ†• Style pour la note moyenne */
    #average-rating {
    font-weight: bold;
    color: #333;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 5px;
    order: -1; /* Place la note moyenne Ã  gauche (avant les flÃ¨ches) */
    flex-direction: column; /* Organise l'Ã©toile/note et le texte en colonne */
    text-align: center;
    line-height: 1.2;
    }

    /* ðŸ†• Conteneur pour l'Ã©toile et la note */
    #average-rating .rating-value {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 1.2em;
    }

    /* ðŸ†• Style pour l'Ã©toile de la moyenne */
    #average-rating .star-icon {
    color: #DDAC17;
    }

    /* ðŸ†• Texte descriptif de la moyenne */
    #average-rating .average-text {
    font-size: 0.7em; /* Rendu plus petit et discret */
    font-weight: normal;
    color: #666;
    margin-top: 2px;
    }

    /* Style pour le compteur de commentaires */
    #review-counter {
    font-weight: bold;
    color: #333;
    white-space: nowrap; 
    }

    .reviews-carousel {
    display: flex; 
    overflow-x: scroll; 
    scroll-snap-type: x mandatory; 
    scroll-behavior: smooth; 
    -webkit-overflow-scrolling: touch; 
    gap: 20px;
    padding-bottom: 20px; 

    .review-card {
    background-color: #f4f4f4;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 20px;
    text-align: left;
    transition: transform 0.3s ease;
    position: relative;
    
    flex: 0 0 90%; 
    width: 90%;
    max-width: 350px; 
    scroll-snap-align: start; 
    }

    /* Styles des boutons de navigation */
    .carousel-nav-button {
    background: #008060; 
    color: white;
    border: none;
    padding: 8px 12px; 
    cursor: pointer;
    border-radius: 4px; 
    font-size: 1.1em; 
    line-height: 1;
    transition: background 0.3s ease;
    
    width: auto; 
    text-align: center; 
    display: block; 
    }
    .carousel-nav-button:hover {
    background: #555;
    }

    /* MEDIA QUERIES */
    @media (min-width: 601px) {
    .review-card {
        flex: 0 0 calc(33.333% - 13.333px); 
        max-width: none;
    }
    }

    /* Styles des Ã©lÃ©ments de la carte (non modifiÃ©s) */
    .reviewer-info { display: flex; align-items: center; justify-content: flex-start; margin-bottom: 10px; }
    .reviewer-details { text-align: left; }
    .reviewer-details .name { font-weight: bold; color: #333; }
    .reviewer-details .job { color: #666; font-style: italic; }
    .stars { color: #DDAC17; font-size: 1.5em; margin: 10px 0; }
    .comment { font-style: italic; color: #333; line-height: 1.6; }

    /* Logos et badges (non modifiÃ©s) */
    .linkedin-link {
    display: inline-block; position: absolute; top: 10px; right: 38px; width: 24px; height: 24px;
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png');
    background-size: contain; background-repeat: no-repeat; text-indent: -9999px; overflow: hidden;
    }
    .certified-badge {
    position: absolute; top: 10px; right: 10px; width: 24px; height: 24px;
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Check_icon.png/640px-Check_icon.png');
    background-size: contain; background-repeat: no-repeat; z-index: 10;
    }
    @media (max-width: 600px) {
    .review-widget-container { padding: 10px !important; }
    .review-card { padding: 15px; }
    }

    
    h1 { margin: 0 0 8px 0; font-size: clamp(18px, 3.5vw, 32px); line-height:1.05; }
    p  { margin: 0; font-size: clamp(14px, 2.2vw, 18px); opacity: 0.95; }
  </style>
</head>

  
<body>

<div class="review-widget-container">
    
    <div class="carousel-header">
        <span id="average-rating"></span> 
        
        <button class="carousel-nav-button" id="carousel-prev">&#9664;</button>
        <span id="review-counter">Chargement...</span> 
        <button class="carousel-nav-button" id="carousel-next">&#9654;</button>
    </div>
    
    <div class="reviews-carousel">
</div>
</div>

  
</body>

<script>
// ====================================================================
// N'oubliez pas de remplacer ces 3 valeurs par vos informations rÃ©elles
// ====================================================================
const API_KEY = 'AIzaSyA5ltEx_jUIlgC-IrGsubOfKQIHFyg4u78';
// REMARQUE : Remplacez la valeur ci-dessous par l'identifiant rÃ©el de votre Google Spreadsheet.
const SPREADSHEET_ID = '14HcunSAnIfklpemWokAvHl7H_o1yipDbWsQ2k5TE_KY';
// TODO: Replace 'RÃ©ponses au formulaire 1' with your actual sheet name.
const SHEET_NAME = 'RÃ©ponses au formulaire 1';
// ====================================================================

const RANGE = 'A2:G'; 
const REVIEWS_CONTAINER = document.querySelector('.reviews-carousel');

// VARIABLES DE COMPTEUR
let currentReviewIndex = 0; 
let totalReviews = 0;

// FONCTION POUR METTRE Ã€ JOUR LA NOTE MOYENNE
function displayAverageRating(ratings) {
    const avgElement = document.getElementById('average-rating');
    if (!avgElement) return;

    if (ratings.length === 0) {
        avgElement.innerHTML = `
            <div class="rating-value">
                <span class="star-icon">â˜…</span> 0.0
            </div>
            <span class="average-text">Note moyenne</span>
        `;
        return;
    }

    // Calcule la somme des notes
    const sum = ratings.reduce((acc, rating) => acc + rating, 0);
    // Calcule la moyenne et la formatte Ã  une dÃ©cimale
    const average = (sum / ratings.length).toFixed(1);
    
    // Ajout du texte descriptif
    avgElement.innerHTML = `
        <div class="rating-value">
            <span class="star-icon">â˜…</span> ${average}
        </div>
        <span class="average-text">Note moyenne</span>
    `;
}

// FONCTION POUR METTRE Ã€ JOUR LE COMPTEUR D'AFFICHAGE
function updateCounter() {
    const counterElement = document.getElementById('review-counter');
    if (counterElement && totalReviews > 0) {
        // Le compteur affiche uniquement le nombre d'avis
        counterElement.textContent = `${currentReviewIndex + 1} / ${totalReviews} avis`;
    } else if (counterElement) {
        counterElement.textContent = `0 avis`;
    }
}


// Fonction pour faire dÃ©filer le carrousel
function scrollCarousel(direction) {
    // Calcul du nouvel index
    let newIndex = currentReviewIndex + direction;

    // Logique d'arrÃªt aux extrÃ©mitÃ©s
    if (newIndex < 0) {
        newIndex = 0;
        return; 
    }
    if (newIndex >= totalReviews) {
        newIndex = totalReviews - 1;
        return; 
    }
    
    // Mise Ã  jour de l'index
    currentReviewIndex = newIndex;
    updateCounter(); 

    // Calcul et exÃ©cution du dÃ©filement
    const cardElement = REVIEWS_CONTAINER.children[currentReviewIndex];
    if (!cardElement) return;

    // 20 est l'espacement (gap) entre les cartes
    const scrollDistance = cardElement.offsetWidth + 20; 
    
    REVIEWS_CONTAINER.scrollTo({ 
        left: currentReviewIndex * scrollDistance, 
        behavior: 'smooth'
    });
};


async function fetchReviews() {
    try {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}!${RANGE}?key=${API_KEY}`);
        const data = await response.json();
        const reviews = data.values;
        
        if (!reviews || reviews.length === 0) {
            console.error('Aucune donnÃ©e trouvÃ©e dans la feuille de calcul.');
            totalReviews = 0;
            updateCounter();
            displayAverageRating([]); 
            return;
        }

        const validRatings = []; 

        reviews.forEach(row => {
            const [timestamp, prenom, job, rating, comment, linkedinUrl, isVerified] = row;
            
            // FILTRE : Seuls les avis oÃ¹ 'isVerified' est exactement '1' sont conservÃ©s.
            if (isVerified !== '1') {
                return; 
            }
            
            // Enregistre la note si elle est valide
            const numericRating = parseFloat(rating) || 0;
            if (numericRating > 0) {
                validRatings.push(numericRating);
            }
            
            if (!prenom && !comment) { return; }

            const reviewCard = document.createElement('div');
            reviewCard.className = 'review-card';

            const filledStars = 'â˜…'.repeat(Math.round(numericRating));
            const emptyStars = 'â˜†'.repeat(5 - Math.round(numericRating));
            const starHtml = filledStars + emptyStars;
            
            const certifiedBadge = `<div class="certified-badge"></div>`; 
            const linkedinSection = linkedinUrl ? `<a href="${linkedinUrl}" class="linkedin-link" target="_blank"></a>` : '';

            const reviewerInfo = `
                <div class="reviewer-info">
                    <div class="reviewer-details">
                        <span class="name">${prenom}</span><br>
                        <span class="job">${job}</span>
                    </div>
                </div>
            `;
            const ratingSection = rating ? `<div class="stars">${starHtml}</div>` : '';
            const commentSection = comment ? `<div class="comment">${comment}</div>` : '';

            reviewCard.innerHTML = `
                ${certifiedBadge}
                ${linkedinSection}
                ${reviewerInfo}
                ${ratingSection}
                ${commentSection}
            `;

            REVIEWS_CONTAINER.appendChild(reviewCard);
        });
        
        // Initialisation du compteur et de la note moyenne
        totalReviews = REVIEWS_CONTAINER.children.length;
        currentReviewIndex = 0;
        updateCounter();
        displayAverageRating(validRatings); 

        // Attachement des Ã©vÃ©nements de clic
        const prevButton = document.getElementById('carousel-prev');
        const nextButton = document.getElementById('carousel-next');

        if (prevButton && nextButton) {
            prevButton.addEventListener('click', () => {
                scrollCarousel(-1);
            });

            nextButton.addEventListener('click', () => {
                scrollCarousel(1);
            });
        }

    } catch (error) {
        console.error('Erreur lors de la rÃ©cupÃ©ration des avis via l\'API :', error);
    }
}

fetchReviews();
</script>
</html>
